# Add Gender Field to Dugsi Students

Add gender (Male/Female) selection to Dugsi student registration with database support, form validation, and admin display with gender icons.

## Overview

Add a required gender field for Dugsi students only (not Mahad). Store in database, display with icons in admin table.

## Database Changes

### 1. Update Prisma Schema (`prisma/schema.prisma`)

Add Gender enum after existing enums (around line 200):

```prisma
enum Gender {
  MALE
  FEMALE
}
```

Add gender field to Student model (around line 240, after `program` field):

```prisma
model Student {
  // ... existing fields ...
  program              Program?
  gender               Gender?
  // ... rest of fields ...
}
```

### 2. Create Migration

Run: `npx prisma migrate dev --name add_gender_field`

## Form Schema Changes

### 3. Update Registration Schemas (`lib/registration/schemas/registration.ts`)

Add Gender enum import at top:

```typescript
import { EducationLevel, GradeLevel, Gender } from '@prisma/client'
```

Add gender options constant (after DUGSI_GRADE_OPTIONS, around line 73):

```typescript
export const GENDER_OPTIONS = [
  { value: 'MALE', label: 'Boy' },
  { value: 'FEMALE', label: 'Girl' },
] as const
```

Update `childInfoSchema` (around line 156) to include gender as required:

```typescript
export const childInfoSchema = z.object({
  firstName: nameSchema,
  lastName: nameSchema,
  gender: z.nativeEnum(Gender, {
    required_error: 'Please select gender',
  }),
  dateOfBirth: z.date(),
  // ... rest unchanged
})
```

Update `DEFAULT_CHILD_VALUES` (around line 233):

```typescript
export const DEFAULT_CHILD_VALUES: ChildInfo = {
  firstName: '',
  lastName: '',
  gender: undefined as unknown as Gender,
  dateOfBirth: null as unknown as Date,
  // ... rest unchanged
}
```

## UI Components

### 4. Add Gender Radio Buttons (`app/dugsi/register/components/dugsi-register-form.tsx`)

Import RadioGroup components (add to existing imports around line 16):

```typescript
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'
```

Import GENDER_OPTIONS (add to imports from schemas, around line 36):

```typescript
import {
  dugsiRegistrationSchema,
  // ... existing imports
  GENDER_OPTIONS,
} from '@/lib/registration/schemas/registration'
```

Add gender radio buttons in each child card, right after name fields (around line 230, before DateOfBirthField):

```typescript
{/* Gender Selection */}
<FormFieldWrapper
  name={`children.${index}.gender`}
  control={form.control}
  label="Gender"
  required
>
  {(field) => (
    <RadioGroup
      value={field.value}
      onValueChange={field.onChange}
      className="flex gap-4"
    >
      {GENDER_OPTIONS.map((option) => (
        <div key={option.value} className="flex items-center space-x-2">
          <RadioGroupItem
            value={option.value}
            id={`children.${index}.gender-${option.value}`}
          />
          <Label
            htmlFor={`children.${index}.gender-${option.value}`}
            className="cursor-pointer font-normal"
          >
            {option.label}
          </Label>
        </div>
      ))}
    </RadioGroup>
  )}
</FormFieldWrapper>
```

### 5. Update Server Action (`app/dugsi/register/actions.ts`)

Update the student creation to include gender (around line 45, in the `student.create` call):

```typescript
await prisma.student.create({
  data: {
    name: fullName,
    dateOfBirth: child.dateOfBirth,
    gender: child.gender, // Add this line
    educationLevel: child.educationLevel,
    // ... rest unchanged
  },
})
```

## Admin Display

### 6. Update Admin Data Fetch (`app/admin/dugsi/actions.ts`)

Add gender to the select statement (around line 13):

```typescript
select: {
  id: true,
  name: true,
  gender: true, // Add this
  dateOfBirth: true,
  // ... rest unchanged
}
```

### 7. Add Gender Icon Column (`app/admin/dugsi/components/dugsi-registrations-table.tsx`)

Import gender-related icons (add to lucide-react imports around line 5):

```typescript
import { User } from 'lucide-react'
```

Add gender column header (in TableHeader around line 308, after Child Name):

```typescript
<TableHead className="w-16">Gender</TableHead>
```

Add gender icon cell in desktop table (around line 325, after child name cell):

```typescript
<TableCell className="w-16">
  {registration.gender === 'MALE' ? (
    <User className="h-5 w-5 text-blue-500" />
  ) : registration.gender === 'FEMALE' ? (
    <User className="h-5 w-5 text-pink-500" />
  ) : (
    <span className="text-xs text-muted-foreground">—</span>
  )}
</TableCell>
```

Update colSpan for empty state from 5 to 6 (around line 320).

Add gender to mobile cards (around line 570, after child name):

```typescript
<div>
  <p className="text-[11px] text-muted-foreground">Gender</p>
  {registration.gender === 'MALE' ? (
    <div className="flex items-center gap-1.5">
      <User className="h-4 w-4 text-blue-500" />
      <p className="text-sm">Boy</p>
    </div>
  ) : registration.gender === 'FEMALE' ? (
    <div className="flex items-center gap-1.5">
      <User className="h-4 w-4 text-pink-500" />
      <p className="text-sm">Girl</p>
    </div>
  ) : (
    <p className="text-sm text-muted-foreground">—</p>
  )}
</div>
```

### 8. Add Gender to Detail Drawer

In the children section of the detail drawer (around line 640), add gender display after the child name:

```typescript
<div className="mt-2 grid gap-2 text-sm">
  <div className="flex items-center gap-2">
    {child.gender === 'MALE' ? (
      <>
        <User className="h-4 w-4 text-blue-500" />
        <span className="text-muted-foreground">Boy</span>
      </>
    ) : child.gender === 'FEMALE' ? (
      <>
        <User className="h-4 w-4 text-pink-500" />
        <span className="text-muted-foreground">Girl</span>
      </>
    ) : null}
  </div>
  {/* Rest of child details */}
</div>
```

### 9. Update Success Dialog (`app/dugsi/register/components/dugsi-success-dialog.tsx`)

Add gender display in the children section (around line 140), after the child's name:

```typescript
<div className="flex items-center gap-2 text-sm text-muted-foreground">
  {child.gender === 'MALE' ? (
    <>
      <User className="h-4 w-4 text-blue-500" />
      <span>Boy</span>
    </>
  ) : child.gender === 'FEMALE' ? (
    <>
      <User className="h-4 w-4 text-pink-500" />
      <span>Girl</span>
    </>
  ) : null}
</div>
```

## Testing

1. Test Dugsi registration form with gender selection
2. Verify required validation works
3. Verify gender saves to database
4. Check gender icons display in admin table (blue for boys, pink for girls)
5. Verify gender shows in detail drawer
6. Verify gender shows in success dialog
7. Run production build to check for errors

## Files Modified

- `prisma/schema.prisma` - Add Gender enum and field
- `lib/registration/schemas/registration.ts` - Add gender to schema
- `app/dugsi/register/components/dugsi-register-form.tsx` - Add radio buttons
- `app/dugsi/register/actions.ts` - Save gender field
- `app/dugsi/register/components/dugsi-success-dialog.tsx` - Display gender
- `app/admin/dugsi/actions.ts` - Fetch gender field
- `app/admin/dugsi/components/dugsi-registrations-table.tsx` - Display gender icons

## Migration Created

- `prisma/migrations/YYYYMMDDHHMMSS_add_gender_field/migration.sql`
